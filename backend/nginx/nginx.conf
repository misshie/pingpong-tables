# Basic Nginx configuration for events module
events {}

http {
    # Define a server that listens for incoming connections
    server {
        # Listen on port 443 for SSL (HTTPS) connections
        listen 443 ssl;

        # The server name, 'localhost' is suitable for local development
        server_name localhost;

        # Specify the paths to the SSL certificate and private key
        # These paths correspond to where the entrypoint.sh script generates them
        ssl_certificate /etc/ssl/certs/server.crt;
        ssl_certificate_key /etc/ssl/private/server.key;

        # Define how to handle requests to the root URL (/) and all subpaths
        location / {
            # Forward the request to the 'api' service defined in compose.yml
            # The 'api' service is running on port 5000 inside the Docker network
            proxy_pass http://api:5000;

            # Set headers to pass along original request information to the FastAPI app
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }
}
